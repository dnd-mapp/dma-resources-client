# End-to-End (E2E) Testing Setup

This project uses [Playwright](https://playwright.dev/) for end-to-end (E2E) testing of the **D&D Mapp: Resources Client**.

E2E tests are configured to run both locally and in CI, against either a local instance of the app or a remote test environment.

---

## Overview

The Playwright tests cover user-facing flows in the Angular app and can be run:

- Headless (for CI and fast local runs)
- With the Playwright UI (for debugging and local development)
- With reporting for inspecting test runs after execution

---

## Scripts

The following scripts are defined in `package.json` for E2E testing:

```bash
pnpm e2e         # Run E2E tests in headless mode
pnpm e2e:dev     # Run E2E tests with the Playwright UI
pnpm e2e:reports # Open/inspect Playwright test reports
```

### `pnpm e2e` (Headless)

Runs the full Playwright test suite in headless mode:

- Suitable for CI and quick local verification
- Does not open any browser UI
- Produces Playwright reports that can later be viewed via `pnpm e2e:reports`

### `pnpm e2e:dev` (With UI)

Runs the Playwright test suite with the Playwright UI:

- Opens the Playwright test runner UI
- Useful for debugging test failures
- Allows stepping through tests and inspecting selectors, traces, etc.

### `pnpm e2e:reports`

Opens the Playwright HTML report generated by previous E2E runs:

- Can be used after either `pnpm e2e` or `pnpm e2e:dev`
- Shows test results, failures, screenshots, traces, and logs (depending on configuration)

---

## Target Environments

### CI Environment

In Continuous Integration (CI), E2E tests are executed against the remote **test environment**:

- **Base URL:** https://resources-test.dndmapp.nl.eu.org/app

The CI pipeline is responsible for:

- Running the E2E tests in headless mode (typically via `pnpm e2e`)

### Local Environment

When running E2E tests locally, Playwright targets a **locally running** instance of the Angular app:

- If an instance of the app is **already running**, that instance will be reused.
- If **no** instance is running, the test setup will start the app automatically before executing the E2E tests.

This behavior allows you to:

- Integrate E2E tests into your normal development workflow (reusing your running dev server), or
- Rely on the test command to handle starting and stopping the app.

> The exact local base URL and port are determined by the app configuration and Playwright configuration (e.g. `playwright.config.ts`).

---

## Typical Usage

### 1. Running E2E Tests Locally (Headless)

```bash
pnpm install
pnpm exec playwright install chromium
pnpm e2e
```

This will:

1. Ensure dependencies are installed.
2. Start the app if needed.
3. Run the E2E suite in headless mode.
4. Generate a Playwright report.

### 2. Running E2E Tests Locally (with UI)

```bash
pnpm install
pnpm e2e:dev
```

This will:

1. Start or reuse the local app.
2. Launch the Playwright UI.
3. Allow interactive debugging of tests.

### 3. Inspecting E2E Reports

After running `pnpm e2e` or `pnpm e2e:dev`:

```bash
pnpm e2e:reports
```

This opens the Playwright HTML report so you can:

- Review passed/failed tests
- Inspect errors and stack traces
- View screenshots, traces, and logs (if enabled in the config)

---

## Notes

- Make sure you have the required browsers installed for Playwright (e.g., via `pnpm exec playwright install`).
- The distinction between local and CI targets is handled via configuration (e.g., environment variables and/or Playwright config files) so that:
    - CI always points to `https://resources-test.dndmapp.nl.eu.org`
    - Local runs point to a local dev instance of the Angular app

For more detailed configuration (such as test files, fixtures, and base URL handling), refer to the Playwright configuration files in this repository.
